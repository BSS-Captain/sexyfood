<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나만의 부산 맛집 파인더 (Gemini AI ✨)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        /* 스크롤바 디자인 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        .tag {
            transition: all 0.2s ease-in-out;
        }
        .tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        /* 모달 스타일 */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        /* 로딩 스피너 */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f59e0b;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="container mx-auto p-4 md:p-8">
        <!-- 헤더 -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">
                <i class="fas fa-utensils text-amber-400"></i>
                나만의 부산 맛집 파인더
            </h1>
            <p class="text-gray-400">내 취향이 담긴 소중한 맛집 리스트</p>
            <!-- Gemini AI 기능 버튼 -->
            <button id="ai-course-btn" class="mt-4 bg-amber-500 hover:bg-amber-600 text-gray-900 font-bold py-2 px-6 rounded-full transition-transform transform hover:scale-105 shadow-lg">
                ✨ AI 맛집 코스 추천받기
            </button>
        </header>

        <!-- 필터 및 검색 섹션 -->
        <div class="bg-gray-800 p-4 rounded-xl mb-8 sticky top-4 z-10 shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- 검색창 -->
                <div class="col-span-1 lg:col-span-2">
                    <label for="search-input" class="block text-sm font-medium text-gray-300 mb-1">맛집 검색</label>
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="상호, 메뉴, 태그 등으로 검색..." class="w-full bg-gray-700 border border-gray-600 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-amber-500 text-white">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
                <!-- 지역 필터 -->
                <div>
                    <label for="area-filter" class="block text-sm font-medium text-gray-300 mb-1">지역 선택</label>
                    <select id="area-filter" class="w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500 text-white">
                        <option value="all">전체 지역</option>
                    </select>
                </div>
                <!-- 카테고리 필터 -->
                <div>
                    <label for="category-filter" class="block text-sm font-medium text-gray-300 mb-1">음식 종류</label>
                    <select id="category-filter" class="w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-amber-500 text-white">
                        <option value="all">전체 종류</option>
                    </select>
                </div>
            </div>
             <div class="flex items-center justify-between mt-4">
                <!-- 방문 여부 필터 -->
                <div class="flex items-center space-x-4">
                    <label class="text-sm font-medium text-gray-300">방문 여부:</label>
                    <div class="flex items-center">
                        <input type="radio" id="visited-all" name="visited-filter" value="all" class="hidden peer" checked>
                        <label for="visited-all" class="px-3 py-1 text-sm rounded-md cursor-pointer peer-checked:bg-amber-500 peer-checked:text-gray-900 bg-gray-700">전체</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" id="visited-y" name="visited-filter" value="Y" class="hidden peer">
                        <label for="visited-y" class="px-3 py-1 text-sm rounded-md cursor-pointer peer-checked:bg-green-500 peer-checked:text-white bg-gray-700">가본 곳</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio"id="visited-n" name="visited-filter" value="N" class="hidden peer">
                        <label for="visited-n" class="px-3 py-1 text-sm rounded-md cursor-pointer peer-checked:bg-yellow-500 peer-checked:text-gray-900 bg-gray-700">갈 곳</label>
                    </div>
                </div>
                <div id="result-count" class="text-sm text-gray-400"></div>
            </div>
        </div>

        <!-- 맛집 리스트 -->
        <main id="restaurant-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- JS로 카드 생성 -->
        </main>
        
        <!-- 검색 결과 없음 메시지 -->
        <div id="no-results" class="hidden text-center py-16">
            <i class="fas fa-ghost text-5xl text-gray-600 mb-4"></i>
            <h3 class="text-2xl font-semibold text-gray-400">검색 결과가 없습니다</h3>
            <p class="text-gray-500">다른 검색어나 필터를 시도해보세요.</p>
        </div>
    </div>

    <!-- Gemini AI 추천 모달 -->
    <div id="ai-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="modal-content bg-gray-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95">
            <div class="flex items-center justify-between p-5 border-b border-gray-700">
                <h2 id="modal-title" class="text-xl font-bold text-white">✨ AI 추천</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <!-- 로딩 인디케이터 -->
                <div id="modal-loader" class="flex flex-col items-center justify-center h-64">
                    <div class="loader"></div>
                    <p class="mt-4 text-gray-400">AI가 열심히 추천 중입니다...</p>
                </div>
                <!-- AI 응답 내용 -->
                <div id="modal-response" class="prose prose-invert max-w-none text-gray-300"></div>
            </div>
            <div id="modal-footer" class="p-4 bg-gray-800 border-t border-gray-700 text-right space-x-3">
                <!-- 동적 버튼 추가 영역 -->
            </div>
        </div>
    </div>


    <script>
        // 구글 시트에서 가져온 맛집 데이터
        const restaurants = [
            { name: "마초스테이크", area: "서면", address: "부산 부산진구 중앙대로680번길 38", phone: "051-808-9585", signatureMenu: "마초삼겹스테이크", price: "1만원대", features: "가성비, 웨이팅", category: "양식", visited: "Y", rating: 4, memo: "점심 특선이 저렴하고 양이 많다. 피크타임에는 웨이팅이 길 수 있으니 참고.", tags: ["#가성비", "#데이트", "#서면맛집"] },
            { name: "피클스피자", area: "서면", address: "부산 부산진구 동천로 69", phone: "0507-1358-6927", signatureMenu: "피클스피자, 베이컨체다피자", price: "2만원대", features: "독특한 피자, 힙한 분위기", category: "양식", visited: "Y", rating: 5, memo: "피클을 싫어해도 맛있게 먹을 수 있는 피자. 도우가 쫀득하고 맛있다. 맥주와 함께 먹는 것을 추천.", tags: ["#피자", "#힙스터", "#전포카페거리"] },
            { name: "뉴러우멘관즈", area: "전포", address: "부산 부산진구 서전로37번길 20 1층", phone: "051-802-9988", signatureMenu: "홍샤오 뉴러우멘", price: "1만원대", features: "진한 국물, 대만 현지 느낌", category: "중식", visited: "Y", rating: 4.5, memo: "대만식 우육면 전문점. 국물이 진하고 고기가 부드러움. 마늘 후레이크 추가 추천.", tags: ["#우육면", "#대만음식", "#혼밥"] },
            { name: "더프타운", area: "전포", address: "부산 부산진구 동성로71번길 23", phone: "0507-1345-8012", signatureMenu: "더프 버거", price: "1만원대", features: "육즙 가득 패티, 수제버거", category: "양식", visited: "N", rating: 0, memo: "전포동의 유명한 수제버거 맛집. 웨이팅이 있을 수 있음.", tags: ["#수제버거", "#전포맛집", "#감성"] },
            { name: "사치문", area: "해운대", address: "부산 해운대구 해운대해변로209번가길 23", phone: "0507-1354-4762", signatureMenu: "사치문 후토마끼", price: "3만원대", features: "분위기 좋은 이자카야, 데이트", category: "일식", visited: "N", rating: 0, memo: "해리단길에 위치한 인기 이자카야. 후토마끼가 시그니처 메뉴.", tags: ["#이자카야", "#해리단길", "#데이트"] },
            { name: "테우치멘 이토", area: "전포", address: "부산 부산진구 전포대로223번길 13", phone: "051-802-5212", signatureMenu: "붓가케 우동", price: "1만원 미만", features: "수타우동, 쫄깃한 면발", category: "일식", visited: "Y", rating: 5, memo: "생활의 달인에 나온 수타우동 맛집. 면발이 정말 쫄깃하고 맛있음. 붓가케 우동 추천.", tags: ["#우동", "#생활의달인", "#혼밥"] },
            { name: "그린파치", area: "광안리", address: "부산 수영구 광안해변로 279 2층", phone: "0507-1407-5542", signatureMenu: "숙성회 코스", price: "5만원 이상", features: "광안대교 뷰, 숙성회", category: "한식", visited: "Y", rating: 4.5, memo: "광안대교가 보이는 뷰 맛집. 숙성회가 신선하고 맛있음. 예약 필수.", tags: ["#숙성회", "#광안리맛집", "#뷰맛집", "#기념일"] },
            { name: "히토우", area: "전포", address: "부산 부산진구 전포대로209번길 11-8", phone: "0507-1329-5692", signatureMenu: "야키토리 오마카세", price: "3만원대", features: "숯불 닭꼬치, 다찌", category: "일식", visited: "N", rating: 0, memo: "전포동의 야키토리 전문점. 다양한 부위의 닭꼬치를 맛볼 수 있음.", tags: ["#야키토리", "#오마카세", "#술집"] },
            { name: "강호", area: "해운대", address: "부산 해운대구 좌동로10번길 55", phone: "051-741-2345", signatureMenu: "멘보샤, 마라전골", price: "2만원대", features: "중식포차, 저녁 6시 오픈", category: "중식", visited: "Y", rating: 4, memo: "멘보샤가 정말 바삭하고 맛있다. 마라전골도 인기 메뉴. 저녁 늦게까지 영업해서 좋음.", tags: ["#중식포차", "#멘보샤", "#해운대술집"] },
            { name: "달인당감냉면", area: "부암", address: "부산 부산진구 백양대로 143", phone: "051-893-1981", signatureMenu: "냉면, 밀면", price: "1만원 미만", features: "숨은 맛집, 현지인 추천", category: "한식", visited: "N", rating: 0, memo: "동네 사람들이 추천하는 냉면, 밀면 맛집. 가성비가 좋다고 함.", tags: ["#냉면", "#밀면", "#로컬맛집"] },
            { name: "해변송정막국수", area: "송정", address: "부산 해운대구 송정해변로 22", phone: "051-702-8399", signatureMenu: "막국수, 수육", price: "1만원대", features: "송정해수욕장 근처", category: "한식", visited: "Y", rating: 3.5, memo: "여름에 시원하게 먹기 좋은 막국수. 수육과 함께 먹으면 더 맛있음.", tags: ["#막국수", "#송정맛집", "#여름음식"] },
            { name: "양산왕돼지국밥", area: "재송동", address: "부산 해운대구 해운대로161번길 11", phone: "051-782-9820", signatureMenu: "돼지국밥", price: "1만원 미만", features: "현지인 맛집, 24시간", category: "한식", visited: "Y", rating: 4, memo: "재송동 주민들이 자주 찾는 돼지국밥집. 국물이 깔끔하고 고기 양이 많음.", tags: ["#돼지국밥", "#부산대표음식", "#로컬맛집"] },
            { name: "맛찬들왕소금구이", area: "해운대", address: "부산 해운대구 해운대로608번길 46", phone: "051-742-0106", signatureMenu: "숙성 생삼겹살", price: "1만원대", features: "직원이 구워줌, 숙성고기", category: "한식", visited: "Y", rating: 5, memo: "직원분들이 직접 고기를 구워줘서 편하고, 고기 맛이 일품. 육즙이 살아있음. 웨이팅 필수.", tags: ["#삼겹살", "#해운대맛집", "#회식"] }
        ];

        const listContainer = document.getElementById('restaurant-list');
        const noResultsContainer = document.getElementById('no-results');
        const searchInput = document.getElementById('search-input');
        const areaFilter = document.getElementById('area-filter');
        const categoryFilter = document.getElementById('category-filter');
        const visitedFilters = document.querySelectorAll('input[name="visited-filter"]');
        const resultCount = document.getElementById('result-count');
        
        // --- Gemini AI & Modal Elements ---
        const aiModal = document.getElementById('ai-modal');
        const modalTitle = document.getElementById('modal-title');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const modalLoader = document.getElementById('modal-loader');
        const modalResponse = document.getElementById('modal-response');
        const modalFooter = document.getElementById('modal-footer');
        const aiCourseBtn = document.getElementById('ai-course-btn');

        // --- Gemini API 호출 함수 ---
        async function callGeminiAPI(prompt, retries = 3, delay = 1000) {
            const apiKey = ""; // API 키는 비워두세요.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (response.status === 429 && retries > 0) { // Throttling
                        await new Promise(res => setTimeout(res, delay));
                        return callGeminiAPI(prompt, retries - 1, delay * 2);
                    }
                    throw new Error(`API 요청 실패: ${response.status}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    return "AI로부터 응답을 받지 못했습니다. 잠시 후 다시 시도해주세요.";
                }
            } catch (error) {
                console.error("Gemini API 호출 중 오류 발생:", error);
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callGeminiAPI(prompt, retries - 1, delay * 2);
                }
                return `오류가 발생했습니다: ${error.message}`;
            }
        }

        // --- 모달 제어 함수 ---
        function openModal() {
            aiModal.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
            setTimeout(() => {
                aiModal.classList.remove('opacity-0');
                aiModal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        }

        function closeModal() {
            aiModal.classList.add('opacity-0');
            aiModal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => {
                aiModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }, 300);
        }

        closeModalBtn.addEventListener('click', closeModal);
        aiModal.addEventListener('click', (e) => {
            if (e.target === aiModal) closeModal();
        });


        // --- AI 맛집 코스 추천 기능 ---
        async function getAICourse() {
            openModal();
            modalTitle.textContent = '✨ AI 맛집 코스 추천';
            modalLoader.classList.remove('hidden');
            modalResponse.innerHTML = '';
            modalFooter.innerHTML = '';

            const simplifiedRestaurants = restaurants.map(r => ({
                name: r.name,
                area: r.area,
                category: r.category,
                tags: r.tags
            }));

            const prompt = `
                너는 부산 최고의 맛집 가이드야. 아래의 부산 맛집 리스트를 보고, 창의적이고 재미있는 테마를 정해서 맛집 코스 1개를 추천해줘.
                코스는 점심, 저녁, 카페, 술집 등을 조합해서 시간 순서대로 짜주고, 각 장소마다 간단한 이유를 덧붙여줘.
                테마의 예시: '뚜벅이를 위한 서면 정복 코스', '광안대교가 보이는 로맨틱 데이트 코스', '비 오는 날 생각나는 뜨끈한 국물 코스'

                맛집 리스트:
                ${JSON.stringify(simplifiedRestaurants)}

                결과는 Markdown 형식으로 제목, 코스, 설명 순서로 깔끔하게 정리해서 보여줘.
            `;

            const responseText = await callGeminiAPI(prompt);
            
            // Basic Markdown to HTML conversion
            let htmlResponse = responseText
                .replace(/### (.*)/g, '<h3 class="text-lg font-semibold text-amber-400 mt-4 mb-2">$1</h3>')
                .replace(/## (.*)/g, '<h2 class="text-xl font-bold text-white mb-3">$1</h2>')
                .replace(/\* \*\*(.*)\*\*/g, '<p class="font-bold mt-2">$1</p>')
                .replace(/\* (.*)/g, '<p class="ml-4">$1</p>')
                .replace(/\n/g, '<br>');

            modalLoader.classList.add('hidden');
            modalResponse.innerHTML = htmlResponse;
            
            // Add regenerate button
            const regenerateBtn = document.createElement('button');
            regenerateBtn.className = "bg-amber-500 hover:bg-amber-600 text-gray-900 font-bold py-2 px-4 rounded-lg";
            regenerateBtn.textContent = "다른 코스 추천받기";
            regenerateBtn.onclick = getAICourse;
            modalFooter.appendChild(regenerateBtn);
        }

        aiCourseBtn.addEventListener('click', getAICourse);


        // --- AI 메모 추천 기능 ---
        async function getAIMemo(restaurantName) {
            const restaurant = restaurants.find(r => r.name === restaurantName);
            if (!restaurant) return;

            openModal();
            modalTitle.textContent = `✨ ${restaurant.name} AI 메모 추천`;
            modalLoader.classList.remove('hidden');
            modalResponse.innerHTML = '';
            modalFooter.innerHTML = '';

            const prompt = `
                너는 맛집 블로거야. 아래 정보를 바탕으로, 이 식당에 대한 방문 후기 메모를 100자 내외로 생생하고 매력적으로 작성해줘.
                - 식당 이름: ${restaurant.name}
                - 지역: ${restaurant.area}
                - 종류: ${restaurant.category}
                - 대표 메뉴: ${restaurant.signatureMenu}
                - 특징: ${restaurant.tags.join(', ')}

                메모는 친구에게 추천하는 것처럼 친근한 말투로 작성해줘.
            `;

            const responseText = await callGeminiAPI(prompt);
            modalLoader.classList.add('hidden');
            modalResponse.innerHTML = `<p class="text-lg leading-relaxed">${responseText}</p>`;

            // Add copy button
            const copyBtn = document.createElement('button');
            copyBtn.className = "bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg";
            copyBtn.innerHTML = '<i class="fas fa-copy mr-2"></i>메모 복사하기';
            copyBtn.onclick = () => {
                const textarea = document.createElement('textarea');
                textarea.value = responseText;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    copyBtn.textContent = '복사 완료!';
                    setTimeout(() => { copyBtn.innerHTML = '<i class="fas fa-copy mr-2"></i>메모 복사하기'; }, 2000);
                } catch (err) {
                    console.error('복사 실패:', err);
                }
                document.body.removeChild(textarea);
            };
            modalFooter.appendChild(copyBtn);
        }

        listContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.ai-memo-btn');
            if (button) {
                const restaurantName = button.dataset.restaurantName;
                getAIMemo(restaurantName);
            }
        });


        // 별점 생성 함수
        function createRatingStars(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 !== 0;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);

            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star text-yellow-400"></i>';
            }
            if (halfStar) {
                stars += '<i class="fas fa-star-half-alt text-yellow-400"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star text-yellow-400"></i>';
            }
            return stars;
        }

        // 맛집 카드 렌더링 함수
        function renderRestaurants(data) {
            listContainer.innerHTML = '';
            if (data.length === 0) {
                listContainer.classList.add('hidden');
                noResultsContainer.classList.remove('hidden');
            } else {
                listContainer.classList.remove('hidden');
                noResultsContainer.classList.add('hidden');
            }
            
            resultCount.textContent = `총 ${data.length}개의 맛집`;

            data.forEach(r => {
                const card = document.createElement('div');
                card.className = 'bg-gray-800 rounded-xl overflow-hidden shadow-lg transform hover:-translate-y-1 transition-transform duration-300 flex flex-col';
                
                let visitedBadge = '';
                if (r.visited === 'Y') {
                    visitedBadge = `<div class="absolute top-3 right-3 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">가본 곳</div>`;
                } else {
                     visitedBadge = `<div class="absolute top-3 right-3 bg-yellow-500 text-gray-900 text-xs font-bold px-2 py-1 rounded-full">갈 곳</div>`;
                }

                card.innerHTML = `
                    <div class="p-5 relative flex-grow">
                        ${visitedBadge}
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="text-xl font-bold text-white pr-16">${r.name}</h3>
                        </div>
                        <div class="flex items-center space-x-2 text-sm text-gray-400 mb-3">
                            <span>${createRatingStars(r.rating)}</span>
                            ${r.rating > 0 ? `<span>(${r.rating})</span>` : '<span class="text-gray-500">평점 없음</span>'}
                        </div>
                        <div class="space-y-2 text-sm mb-4">
                            <p class="text-gray-300"><i class="fas fa-map-marker-alt w-5 text-center mr-1 text-amber-400"></i> ${r.area} &middot; ${r.category}</p>
                            <p class="text-gray-300"><i class="fas fa-signature w-5 text-center mr-1 text-amber-400"></i> ${r.signatureMenu}</p>
                            <p class="text-gray-300"><i class="fas fa-phone w-5 text-center mr-1 text-amber-400"></i> ${r.phone || '정보 없음'}</p>
                        </div>
                        <div class="border-t border-gray-700 pt-3">
                            <p class="text-gray-400 text-sm"><i class="fas fa-comment-dots w-5 text-center mr-1 text-gray-500"></i> ${r.memo}</p>
                        </div>
                    </div>
                     <div class="px-5 pt-2 pb-4 bg-gray-800 border-t border-gray-700">
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${r.tags.map(tag => `<span class="tag bg-gray-700 text-amber-300 text-xs font-semibold px-2.5 py-1 rounded-full">${tag}</span>`).join('')}
                        </div>
                        <button class="ai-memo-btn w-full bg-gray-700 hover:bg-gray-600 text-amber-400 text-sm font-bold py-2 px-4 rounded-lg transition-colors" data-restaurant-name="${r.name}">
                            ✨ AI 메모 추천
                        </button>
                    </div>
                `;
                listContainer.appendChild(card);
            });
        }

        // 필터링 및 검색 로직
        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedArea = areaFilter.value;
            const selectedCategory = categoryFilter.value;
            const selectedVisited = document.querySelector('input[name="visited-filter"]:checked').value;

            const filteredData = restaurants.filter(r => {
                const matchesSearch = searchTerm === '' ||
                    r.name.toLowerCase().includes(searchTerm) ||
                    r.signatureMenu.toLowerCase().includes(searchTerm) ||
                    r.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                    r.area.toLowerCase().includes(searchTerm);

                const matchesArea = selectedArea === 'all' || r.area === selectedArea;
                const matchesCategory = selectedCategory === 'all' || r.category === selectedCategory;
                const matchesVisited = selectedVisited === 'all' || r.visited === selectedVisited;

                return matchesSearch && matchesArea && matchesCategory && matchesVisited;
            });

            renderRestaurants(filteredData);
        }

        // 필터 옵션 동적 생성
        function populateFilters() {
            const areas = [...new Set(restaurants.map(r => r.area))];
            const categories = [...new Set(restaurants.map(r => r.category))];

            areas.sort().forEach(area => {
                const option = document.createElement('option');
                option.value = area;
                option.textContent = area;
                areaFilter.appendChild(option);
            });

            categories.sort().forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        // 이벤트 리스너 등록
        searchInput.addEventListener('input', applyFilters);
        areaFilter.addEventListener('change', applyFilters);
        categoryFilter.addEventListener('change', applyFilters);
        visitedFilters.forEach(filter => filter.addEventListener('change', applyFilters));

        // 초기화
        document.addEventListener('DOMContentLoaded', () => {
            populateFilters();
            renderRestaurants(restaurants);
        });

    </script>
</body>
</html>
